<div class="container">
  <div class="page-header">
    <div class="page-header-content">
      <h1 class="page-title">Relatórios</h1>
      <p class="page-subtitle">Análises detalhadas dos seus achievements</p>
    </div>
    <button pButton label="Exportar Dados" icon="pi pi-download" (click)="exportData()" class="btn-export"></button>
  </div>

  <!-- Filtro de Período -->
  <div class="filter-section">
    <div class="filter-card">
      <div class="filter-header">
        <i class="pi pi-calendar-plus filter-icon"></i>
        <h2 class="filter-title">Relatório por Período</h2>
      </div>
      <div class="filter-content">
        <div class="date-inputs">
          <div class="form-field">
            <label class="field-label">Data Início</label>
            <p-calendar [(ngModel)]="startDate" dateFormat="dd/mm/yy" [showIcon]="true"
              placeholder="Selecione a data inicial" styleClass="calendar-input"></p-calendar>
          </div>
          <div class="form-field">
            <label class="field-label">Data Fim</label>
            <p-calendar [(ngModel)]="endDate" dateFormat="dd/mm/yy" [showIcon]="true"
              placeholder="Selecione a data final" styleClass="calendar-input"></p-calendar>
          </div>
        </div>
        <div class="filter-actions">
          <button pButton label="Gerar Relatório" icon="pi pi-chart-line" (click)="generatePeriodReport()"
            [loading]="loading()" class="btn-primary"></button>
          <button pButton label="Análise IA" icon="pi pi-sparkles" (click)="generateAISummary()" [loading]="loadingAI()"
            class="p-button-success btn-ai"></button>
        </div>
      </div>
    </div>
  </div>

  <!-- Estatísticas do Período -->
  @if (periodReport()) {
  <div class="stats-section fade-in">
    <div class="stats-grid">
      <div class="stat-card stat-card-total">
        <div class="stat-icon-wrapper">
          <i class="pi pi-trophy"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ periodReport()!.total_achievements }}</div>
          <div class="stat-label">Total de Achievements</div>
        </div>
      </div>
      <div class="stat-card stat-card-start">
        <div class="stat-icon-wrapper">
          <i class="pi pi-calendar-plus"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ periodReport()!.start_date | date: 'dd/MM/yyyy' }}</div>
          <div class="stat-label">Data Início</div>
        </div>
      </div>
      <div class="stat-card stat-card-end">
        <div class="stat-icon-wrapper">
          <i class="pi pi-calendar-times"></i>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ periodReport()!.end_date | date: 'dd/MM/yyyy' }}</div>
          <div class="stat-label">Data Fim</div>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Gráficos do Período -->
  @if (periodReport()) {
  <div class="charts-section fade-in">
    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">Achievements por Mês</h3>
          <i class="pi pi-chart-bar chart-icon"></i>
        </div>
        <div class="chart-body">
          <p-chart type="bar" [data]="monthChartData()" [options]="monthChartOptions()" height="320px"></p-chart>
        </div>
      </div>
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">Por Categoria</h3>
          <i class="pi pi-chart-pie chart-icon"></i>
        </div>
        <div class="chart-body">
          <p-chart type="doughnut" [data]="categoryChartData()" [options]="categoryChartOptions()"></p-chart>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- GitHub Stats -->
  @if (githubStats()) {
  <div class="github-section fade-in">
    <h2 class="section-title">
      <i class="pi pi-github section-icon"></i>
      Estatísticas GitHub
    </h2>

    <div class="grid grid-cols-5 mb-4">
      <p-card>
        <div class="text-center">
          <div class="text-2xl text-primary mb-2">{{ githubStats()!.total_github_achievements }}</div>
          <div class="text-secondary">Total GitHub</div>
        </div>
      </p-card>
      <p-card>
        <div class="text-center">
          <div class="text-2xl" style="color: #28A745">{{ githubStats()!.pull_requests }}</div>
          <div class="text-secondary">Pull Requests</div>
        </div>
      </p-card>
      <p-card>
        <div class="text-center">
          <div class="text-2xl" style="color: #007BFF">{{ githubStats()!.issues }}</div>
          <div class="text-secondary">Issues</div>
        </div>
      </p-card>
      <p-card>
        <div class="text-center">
          <div class="text-2xl" style="color: #FFC107">{{ githubStats()!.commits }}</div>
          <div class="text-secondary">Commits</div>
        </div>
      </p-card>
      <p-card>
        <div class="text-center">
          <div class="text-2xl" style="color: #DC3545">{{ githubStats()!.repositories }}</div>
          <div class="text-secondary">Repositories</div>
        </div>
      </p-card>
    </div>

    <p-card header="Distribuição GitHub">
      <p-chart type="bar" [data]="githubChartData()" [options]="githubChartOptions()" height="300px"></p-chart>
    </p-card>

    <!-- AI GitHub Analysis Button -->
    <div class="mt-3">
      <button pButton label="Análise GitHub com IA" icon="pi pi-sparkles" (click)="generateGitHubAIAnalysis()"
        [loading]="loadingGithubAI()" class="p-button-success"></button>
    </div>
  </div>
  }

  <!-- Modal de Análise IA (Período) -->
  <p-dialog [(visible)]="showAIModal" [modal]="true" [style]="{width: '90vw', maxWidth: '800px'}" [draggable]="false"
    [resizable]="false" styleClass="ai-modal">
    <ng-template pTemplate="header">
      <div class="modal-header-content">
        <div class="ai-icon-wrapper-modal">
          <i class="pi pi-sparkles"></i>
        </div>
        <div>
          <h2 class="modal-title">Análise Gerada por IA</h2>
          <p class="modal-subtitle">Insights automáticos sobre seus achievements</p>
        </div>
      </div>
    </ng-template>
    <div class="modal-ai-content">
      @if (aiSummary()) {
      <p class="ai-text">{{ aiSummary()!.ai_generated_report }}</p>
      }
    </div>
  </p-dialog>

  <!-- Modal de Análise GitHub IA -->
  <p-dialog [(visible)]="showGitHubAIModal" [modal]="true" [style]="{width: '90vw', maxWidth: '800px'}"
    [draggable]="false" [resizable]="false" styleClass="ai-modal">
    <ng-template pTemplate="header">
      <div class="modal-header-content">
        <div class="ai-icon-wrapper-modal">
          <i class="pi pi-github"></i>
        </div>
        <div>
          <h2 class="modal-title">Análise GitHub por IA</h2>
          <p class="modal-subtitle">Insights sobre suas contribuições no GitHub</p>
        </div>
      </div>
    </ng-template>
    <div class="modal-ai-content">
      @if (aiGithubAnalysis()) {
      <p class="ai-text" style="white-space: pre-wrap;">{{ aiGithubAnalysis()!.ai_analysis }}</p>
      }
    </div>
  </p-dialog>
