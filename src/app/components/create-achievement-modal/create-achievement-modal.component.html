@if (isOpen()) {
<div class="modal-overlay" (click)="close()">
  <div class="modal-content" #modalContent (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">{{ achievementToEdit() ? 'Editar Achievement' : 'Novo Achievement' }}</h2>
      <button type="button" class="close-button" (click)="close()" aria-label="Fechar">
        <i class="pi pi-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="form-grid">
          <!-- Title Field -->
          <div class="form-field form-field-full">
            <label for="title" class="form-label">
              Título <span class="required">*</span>
            </label>
            <input id="title" pInputText formControlName="title" placeholder="Ex: Implementei feature X no projeto Y"
              class="form-input" [class.input-error]="isFieldInvalid('title')" />
            @if (isFieldInvalid('title')) {
            <small class="field-error">
              <i class="pi pi-exclamation-circle"></i>
              Título é obrigatório (mínimo 3 caracteres)
            </small>
            }
          </div>

          <!-- Description Field -->
          <div class="form-field form-field-full">
            <label for="description" class="form-label">
              Descrição <span class="required">*</span>
            </label>
            <textarea id="description" pInputTextarea formControlName="description"
              placeholder="Descreva seu achievement em detalhes: o que você fez, qual foi o resultado e impacto..."
              rows="6" class="form-textarea" [class.input-error]="isFieldInvalid('description')"></textarea>
            @if (isFieldInvalid('description')) {
            <small class="field-error">
              <i class="pi pi-exclamation-circle"></i>
              Descrição é obrigatória (mínimo 10 caracteres)
            </small>
            }
          </div>

          <!-- Date Field -->
          <div class="form-field">
            <label for="date" class="form-label">
              Data <span class="required">*</span>
            </label>
            <p-datepicker id="date" formControlName="date" dateFormat="dd/mm/yy" [showIcon]="true"
              placeholder="Selecione a data" styleClass="form-calendar" [class.input-error]="isFieldInvalid('date')"
              appendTo="body"></p-datepicker>
            @if (isFieldInvalid('date')) {
            <small class="field-error">
              <i class="pi pi-exclamation-circle"></i>
              Data é obrigatória
            </small>
            }
          </div>

          <!-- Category Field -->
          <div class="form-field">
            <label for="category" class="form-label">
              Categoria <span class="required">*</span>
            </label>
            <p-select id="category" formControlName="category" [options]="categoriesArray" optionLabel="label"
              optionValue="value" placeholder="Selecione a categoria" styleClass="form-dropdown"
              [class.input-error]="isFieldInvalid('category')" appendTo="body"></p-select>
            @if (isFieldInvalid('category')) {
            <small class="field-error">
              <i class="pi pi-exclamation-circle"></i>
              Categoria é obrigatória
            </small>
            }
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button pButton type="submit" [label]="achievementToEdit() ? 'Atualizar Achievement' : 'Criar Achievement'"
            icon="pi pi-check" [loading]="loading()" [disabled]="loading() || form.invalid"
            class="btn-primary"></button>
          <button pButton type="button" label="Cancelar" icon="pi pi-times" class="p-button-outlined p-button-secondary"
            (click)="close()" [disabled]="loading()"></button>
        </div>
      </form>
    </div>
  </div>
</div>
}

<p-toast></p-toast>
