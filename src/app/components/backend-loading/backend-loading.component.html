<div class="backend-loading-overlay" role="status" aria-live="polite">
  <div class="backend-loading-container">
    <div class="loading-content">
      <div class="logo-section">
        <img src="../../../assets/logo-bragdev.png" alt="BragDev" class="logo" />
      </div>

      <div class="spinner-wrapper">
        <p-progressSpinner styleClass="custom-spinner" strokeWidth="3" [style]="{'width': '80px', 'height': '80px'}" />
      </div>

      <div class="status-messages">
        <h2 class="status-title">{{ statusMessage() }}</h2>

        @if (healthService.status().isWarming) {
        <p class="status-description">
          The backend service is starting up from hibernation.

          @if (estimatedWaitTime(); as waitTime) {
          <br /><strong>Estimated wait time: ~{{ waitTime }} seconds</strong>
          } @else {
          <br />This may take up to 60 seconds...
          }
        </p>

        <div class="progress-info">
          <span class="progress-text">
            Attempt {{ attemptNumber() }} of {{ maxAttempts }}
          </span>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="progressPercentage()"></div>
          </div>
        </div>

        @if (showFreeTierNotice()) {
        <div class="info-notice">
          <i class="pi pi-info-circle"></i>
          <p>
            <strong>Why is this taking so long?</strong>
            The backend is hosted on a free tier that hibernates after 15 minutes of inactivity.
            Cold starts can take 30-90 seconds. Subsequent visits will be instant! ⚡
          </p>
        </div>
        }
        } @else {
        <p class="status-description">
          Connecting to server...
        </p>
        }
      </div>

      @if (healthService.hasFailed()) {
      <div class="error-state" role="alert">
        <i class="pi pi-exclamation-triangle error-icon" aria-hidden="true"></i>
        <h3 class="error-title">Connection Failed</h3>
        <p class="error-description">
          Unable to connect to the backend service after {{ maxAttempts }} attempts.
          @if (healthService.status().lastError) {
          <br /><strong>Error: {{ healthService.status().lastError }}</strong>
          }
          <br />Please check your internet connection and try again.
        </p>
        <p-button 
          label="Retry Connection" 
          icon="pi pi-refresh" 
          (onClick)="retry()" 
          styleClass="retry-button"
          [attr.aria-label]="'Retry connection to backend service'" />
      </div>
      }

      @if (showWarning()) {
      <div class="warning-notice" role="alert">
        <p>
          <strong>⚠️ Backend is taking longer than usual.</strong> You can:
        </p>
        <ul>
          <li>Wait a bit more (it should connect soon)</li>
          <li>Check backend status at
            <a href="https://api-bragdoc.farigab.com/api/health" target="_blank" rel="noopener noreferrer">
              api-bragdoc.farigab.com/api/health
            </a>
          </li>
          <li>Try refreshing the page</li>
        </ul>
      </div>
      }
    </div>
  </div>
</div>